<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OCDE: npm-pick-manifest &lt;a href=&quot;https://npm.im/npm-pick-manifest&quot;&gt;&lt;img src=&quot;https://img.shields.io/npm/v/npm-pick-manifest.svg&quot; alt=&quot;npm version&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://npm.im/npm-pick-manifest&quot;&gt;&lt;img src=&quot;https://img.shields.io/npm/l/npm-pick-manifest.svg&quot; alt=&quot;license&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://travis-ci.org/npm/npm-pick-manifest&quot;&gt;&lt;img src=&quot;https://img.shields.io/travis/npm/npm-pick-manifest.svg&quot; alt=&quot;Travis&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://coveralls.io/github/npm/npm-pick-manifest?branch=latest&quot;&gt;&lt;img src=&quot;https://coveralls.io/repos/github/npm/npm-pick-manifest/badge.svg?branch=latest&quot; alt=&quot;Coverage Status&quot;/&gt;&lt;/a&gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OCDE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_frontend_node_modules_npm-pick-manifest__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">npm-pick-manifest <a href="https://npm.im/npm-pick-manifest"><img src="https://img.shields.io/npm/v/npm-pick-manifest.svg" alt="npm version" style="pointer-events: none;" class="inline"/></a> <a href="https://npm.im/npm-pick-manifest"><img src="https://img.shields.io/npm/l/npm-pick-manifest.svg" alt="license" style="pointer-events: none;" class="inline"/></a> <a href="https://travis-ci.org/npm/npm-pick-manifest"><img src="https://img.shields.io/travis/npm/npm-pick-manifest.svg" alt="Travis" style="pointer-events: none;" class="inline"/></a> <a href="https://coveralls.io/github/npm/npm-pick-manifest?branch=latest"><img src="https://coveralls.io/repos/github/npm/npm-pick-manifest/badge.svg?branch=latest" alt="Coverage Status" style="pointer-events: none;" class="inline"/></a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://github.com/npm/npm-pick-manifest"><code>npm-pick-manifest</code></a> is a standalone implementation of <a href="https://npmjs.com">npm</a>'s semver range resolution algorithm.</p>
<h1><a class="anchor" id="autotoc_md17657"></a>
Install</h1>
<p><code>$ npm install --save npm-pick-manifest</code></p>
<h1><a class="anchor" id="autotoc_md17658"></a>
Table of Contents</h1>
<ul>
<li><a href="#example">Example</a></li>
<li><a href="#features">Features</a></li>
<li><a href="#api">API</a><ul>
<li><a href="#pick-manifest"><code>pickManifest()</code></a></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md17659"></a>
Example</h2>
<div class="fragment"><div class="line">const pickManifest = require(&#39;npm-pick-manifest&#39;)</div>
<div class="line"> </div>
<div class="line">fetch(&#39;https://registry.npmjs.org/npm-pick-manifest&#39;).then(res =&gt; {</div>
<div class="line">  return res.json()</div>
<div class="line">}).then(packument =&gt; {</div>
<div class="line">  return pickManifest(packument, &#39;^1.0.0&#39;)</div>
<div class="line">}) // get same manifest as npm would get if you `npm i npm-pick-manifest@^1.0.0`</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md17660"></a>
Features</h2>
<ul>
<li>Uses npm's exact <a href="http://npm.im/semver">semver resolution algorithm</a>.</li>
<li>Supports ranges, tags, and versions.</li>
<li>Prefers non-deprecated versions to deprecated versions.</li>
<li>Prefers versions whose <code>engines</code> requirements are satisfied over those that will raise a warning or error at install time.</li>
</ul>
<h2><a class="anchor" id="autotoc_md17661"></a>
API</h2>
<h3><a class="anchor" id="autotoc_md17662"></a>
&lt;a name="pick-manifest"&gt;&lt;/a&gt; &lt;tt&gt;&gt; pickManifest(packument, selector, [opts]) -&gt; manifest&lt;/tt&gt;</h3>
<p>Returns the manifest that best matches <code>selector</code>, or throws an error.</p>
<p>Packuments are anything returned by metadata URLs from the npm registry. That is, they're objects with the following shape (only fields used by <code>npm-pick-manifest</code> included):</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  name: &#39;some-package&#39;,</div>
<div class="line">  &#39;dist-tags&#39;: {</div>
<div class="line">    foo: &#39;1.0.1&#39;</div>
<div class="line">  },</div>
<div class="line">  versions: {</div>
<div class="line">    &#39;1.0.0&#39;: { version: &#39;1.0.0&#39; },</div>
<div class="line">    &#39;1.0.1&#39;: { version: &#39;1.0.1&#39; },</div>
<div class="line">    &#39;1.0.2&#39;: { version: &#39;1.0.2&#39; },</div>
<div class="line">    &#39;2.0.0&#39;: { version: &#39;2.0.0&#39; }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The algorithm will follow npm's algorithm for semver resolution, and only <code>tag</code>, <code>range</code>, and <code>version</code> selectors are supported.</p>
<p>The function will throw <code>ETARGET</code> if there was no matching manifest, and <code>ENOVERSIONS</code> if the packument object has no valid versions in <code>versions</code>. If the only matching manifest is included in a <code>policyRestrictions</code> section of the packument, then an <code>E403</code> is raised.</p>
<h3><a class="anchor" id="autotoc_md17663"></a>
&lt;a name="pick-manifest-options"&gt;&lt;/a&gt; Options</h3>
<p>All options are optional.</p>
<ul>
<li><code>includeStaged</code> - Boolean, default <code>false</code>. Include manifests in the <code>stagedVersions.versions</code> set, to support installing <a href="https://github.com/npm/rfcs/pull/92">staged packages</a> when appropriate. Note that staged packages are always treated as lower priority than actual publishes, even when <code>includeStaged</code> is set.</li>
<li><code>defaultTag</code> - String, default &lsquo;'latest&rsquo;<code>. The default</code>dist-tag` to install when no specifier is provided. Note that the version indicated by this specifier will be given top priority if it matches a supplied semver range.</li>
<li><code>before</code> - String, Date, or Number, default <code>null</code>. This is passed to <code>new Date()</code>, so anything that works there will be valid. Do not consider <em>any</em> manifests that were published after the date indicated. Note that this is only relevant when the packument includes a <code>time</code> field listing the publish date of all the packages.</li>
<li><code>nodeVersion</code> - String, default <code>process.version</code>. The Node.js version to use when checking manifests for <code>engines</code> requirement satisfaction.</li>
<li><code>npmVersion</code> - String, default <code>null</code>. The npm version to use when checking manifest for <code>engines</code> requirement satisfaction. (If <code>null</code>, then this particular check is skipped.)</li>
<li><code>avoid</code> - String, default <code>null</code>. A SemVer range of versions that should be avoided. An avoided version MAY be selected if there is no other option, so when using this for version selection ensure that you check the result against the range to see if there was no alternative available.</li>
<li><code>avoidStrict</code> Boolean, default <code>false</code>. If set to true, then <code>pickManifest</code> will never return a version in the <code>avoid</code> range. If the only available version in the <code>wanted</code> range is a version that should be avoided, then it will return a version <em>outside</em> the <code>wanted</code> range, preferring to do so without making a SemVer-major jump, if possible. If there are no versions outside the <code>avoid</code> range, then throw an <code>ETARGET</code> error. It does this by calling pickManifest first with the <code>wanted</code> range, then with a <code>^</code> affixed to the version returned by the <code>wanted</code> range, and then with a <code>*</code> version range, and throwing if nothing could be found to satisfy the avoidance request.</li>
</ul>
<p>Return value is the manifest as it exists in the packument, possibly decorated with the following boolean flags:</p>
<ul>
<li><code>_shouldAvoid</code> The version is in the <code>avoid</code> range. Watch out!</li>
<li><code>_outsideDependencyRange</code> The version is outside the <code>wanted</code> range, because <code>avoidStrict: true</code> was set.</li>
<li><code>_isSemVerMajor</code> The <code>_outsideDependencyRange</code> result is a SemVer-major step up from the version returned by the <code>wanted</code> range.</li>
</ul>
<h2><a class="anchor" id="autotoc_md17664"></a>
Algorithm</h2>
<ol type="1">
<li>Create list of all versions in <code>versions</code>, <code>policyRestrictions.versions</code>, and (if <code>includeStaged</code> is set) <code>stagedVersions.versions</code>.</li>
<li>If a <code>dist-tag</code> is requested,<ol type="a">
<li>If the manifest is not after the specified <code>before</code> date, then select that from the set.</li>
<li>If the manifest is after the specified <code>before</code> date, then re-start the selection looking for the highest SemVer range that is equal to or less than the <code>dist-tag</code> target.</li>
</ol>
</li>
<li>If a specific version is requested,<ol type="a">
<li>If the manifest is not after the specified <code>before</code> date, then select the specified manifest.</li>
<li>If the manifest is after the specified <code>before</code> date, then raise <code>ETARGET</code> error. (NB: this is a breaking change from v5, where a specified version would override the <code>before</code> setting.)</li>
</ol>
</li>
<li>(At this point we know a range is requested.)</li>
<li>If the <code>defaultTag</code> refers to a <code>dist-tag</code> that satisfies the range (or if the range is &lsquo;&rsquo;*'<code>or</code>''<code>), and the manifest is published before the </code>before` setting, then select that manifest.</li>
<li>If nothing is yet selected, sort by the following heuristics in order, and select the top item:<ol type="a">
<li>Prioritize versions that are not in the <code>avoid</code> range over those that are.</li>
<li>Prioritize versions that are not in <code>policyRestrictions</code> over those that are.</li>
<li>Prioritize published versions over staged versions.</li>
<li>Prioritize versions that are not deprecated, and which have a satisfied engines requirement, over those that are either deprecated or have an engines mismatch.</li>
<li>Prioritize versions that have a satisfied engines requirement over those that do not.</li>
<li>Prioritize versions that are not are not deprecated (but have a mismatched engines requirement) over those that are deprecated.</li>
<li>Prioritize higher SemVer precedence over lower SemVer precedence.</li>
</ol>
</li>
<li>If no manifest was selected, raise an <code>ETARGET</code> error.</li>
<li>If the selected item is in the <code>policyRestrictions.versions</code> list, raise an <code>E403</code> error.</li>
<li>Return the selected manifest. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
