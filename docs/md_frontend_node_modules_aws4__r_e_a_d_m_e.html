<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OCDE: aws4</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OCDE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_frontend_node_modules_aws4__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">aws4 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/github/mhart/aws4"><img src="https://api.travis-ci.org/mhart/aws4.png?branch=master" alt="Build Status" class="inline"/></a></p>
<p>A small utility to sign vanilla Node.js http(s) request options using Amazon's <a href="https://docs.aws.amazon.com/general/latest/gr/signature-version-4.html">AWS Signature Version 4</a>.</p>
<p>If you want to sign and send AWS requests in a modern browser, or an environment like <a href="https://developers.cloudflare.com/workers/">Cloudflare Workers</a>, then check out <a href="https://github.com/mhart/aws4fetch">aws4fetch</a> â€“ otherwise you can also bundle this library for use <a href="./browser">in older browsers</a>.</p>
<p>The only AWS service that <em>doesn't</em> support v4 as of 2020-05-22 is <a href="https://docs.aws.amazon.com/AmazonSimpleDB/latest/DeveloperGuide/SDB_API.html">SimpleDB</a> (it only supports <a href="https://github.com/mhart/aws2">AWS Signature Version 2</a>).</p>
<p>It also provides defaults for a number of core AWS headers and request parameters, making it very easy to query AWS services, or build out a fully-featured AWS library.</p>
<h1><a class="anchor" id="autotoc_md3387"></a>
Example</h1>
<div class="fragment"><div class="line">var https = require(&#39;https&#39;)</div>
<div class="line">var aws4  = require(&#39;aws4&#39;)</div>
<div class="line"> </div>
<div class="line">// to illustrate usage, we&#39;ll create a utility function to request and pipe to stdout</div>
<div class="line">function request(opts) { https.request(opts, function(res) { res.pipe(process.stdout) }).end(opts.body || &#39;&#39;) }</div>
<div class="line"> </div>
<div class="line">// aws4 will sign an options object as you&#39;d pass to http.request, with an AWS service and region</div>
<div class="line">var opts = { host: &#39;my-bucket.s3.us-west-1.amazonaws.com&#39;, path: &#39;/my-object&#39;, service: &#39;s3&#39;, region: &#39;us-west-1&#39; }</div>
<div class="line"> </div>
<div class="line">// aws4.sign() will sign and modify these options, ready to pass to http.request</div>
<div class="line">aws4.sign(opts, { accessKeyId: &#39;&#39;, secretAccessKey: &#39;&#39; })</div>
<div class="line"> </div>
<div class="line">// or it can get credentials from process.env.AWS_ACCESS_KEY_ID, etc</div>
<div class="line">aws4.sign(opts)</div>
<div class="line"> </div>
<div class="line">// for most AWS services, aws4 can figure out the service and region if you pass a host</div>
<div class="line">opts = { host: &#39;my-bucket.s3.us-west-1.amazonaws.com&#39;, path: &#39;/my-object&#39; }</div>
<div class="line"> </div>
<div class="line">// usually it will add/modify request headers, but you can also sign the query:</div>
<div class="line">opts = { host: &#39;my-bucket.s3.amazonaws.com&#39;, path: &#39;/?X-Amz-Expires=12345&#39;, signQuery: true }</div>
<div class="line"> </div>
<div class="line">// and for services with simple hosts, aws4 can infer the host from service and region:</div>
<div class="line">opts = { service: &#39;sqs&#39;, region: &#39;us-east-1&#39;, path: &#39;/?Action=ListQueues&#39; }</div>
<div class="line"> </div>
<div class="line">// and if you&#39;re using us-east-1, it&#39;s the default:</div>
<div class="line">opts = { service: &#39;sqs&#39;, path: &#39;/?Action=ListQueues&#39; }</div>
<div class="line"> </div>
<div class="line">aws4.sign(opts)</div>
<div class="line">console.log(opts)</div>
<div class="line">/*</div>
<div class="line">{</div>
<div class="line">  host: &#39;sqs.us-east-1.amazonaws.com&#39;,</div>
<div class="line">  path: &#39;/?Action=ListQueues&#39;,</div>
<div class="line">  headers: {</div>
<div class="line">    Host: &#39;sqs.us-east-1.amazonaws.com&#39;,</div>
<div class="line">    &#39;X-Amz-Date&#39;: &#39;20121226T061030Z&#39;,</div>
<div class="line">    Authorization: &#39;AWS4-HMAC-SHA256 Credential=ABCDEF/20121226/us-east-1/sqs/aws4_request, ...&#39;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line">*/</div>
<div class="line"> </div>
<div class="line">// we can now use this to query AWS</div>
<div class="line">request(opts)</div>
<div class="line">/*</div>
<div class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</div>
<div class="line">&lt;ListQueuesResponse xmlns=&quot;https://queue.amazonaws.com/doc/2012-11-05/&quot;&gt;</div>
<div class="line">...</div>
<div class="line">*/</div>
<div class="line"> </div>
<div class="line">// aws4 can infer the HTTP method if a body is passed in</div>
<div class="line">// method will be POST and Content-Type: &#39;application/x-www-form-urlencoded; charset=utf-8&#39;</div>
<div class="line">request(aws4.sign({ service: &#39;iam&#39;, body: &#39;Action=ListGroups&amp;Version=2010-05-08&#39; }))</div>
<div class="line">/*</div>
<div class="line">&lt;ListGroupsResponse xmlns=&quot;https://iam.amazonaws.com/doc/2010-05-08/&quot;&gt;</div>
<div class="line">...</div>
<div class="line">*/</div>
<div class="line"> </div>
<div class="line">// you can specify any custom option or header as per usual</div>
<div class="line">request(aws4.sign({</div>
<div class="line">  service: &#39;dynamodb&#39;,</div>
<div class="line">  region: &#39;ap-southeast-2&#39;,</div>
<div class="line">  method: &#39;POST&#39;,</div>
<div class="line">  path: &#39;/&#39;,</div>
<div class="line">  headers: {</div>
<div class="line">    &#39;Content-Type&#39;: &#39;application/x-amz-json-1.0&#39;,</div>
<div class="line">    &#39;X-Amz-Target&#39;: &#39;DynamoDB_20120810.ListTables&#39;</div>
<div class="line">  },</div>
<div class="line">  body: &#39;{}&#39;</div>
<div class="line">}))</div>
<div class="line">/*</div>
<div class="line">{&quot;TableNames&quot;:[]}</div>
<div class="line">...</div>
<div class="line">*/</div>
<div class="line"> </div>
<div class="line">// The raw RequestSigner can be used to generate CodeCommit Git passwords</div>
<div class="line">var signer = new aws4.RequestSigner({</div>
<div class="line">  service: &#39;codecommit&#39;,</div>
<div class="line">  host: &#39;git-codecommit.us-east-1.amazonaws.com&#39;,</div>
<div class="line">  method: &#39;GIT&#39;,</div>
<div class="line">  path: &#39;/v1/repos/MyAwesomeRepo&#39;,</div>
<div class="line">})</div>
<div class="line">var password = signer.getDateTime() + &#39;Z&#39; + signer.signature()</div>
<div class="line"> </div>
<div class="line">// see example.js for examples with other services</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3388"></a>
API</h1>
<h2><a class="anchor" id="autotoc_md3389"></a>
aws4.sign(requestOptions, [credentials])</h2>
<p>Calculates and populates any necessary AWS headers and/or request options on <code>requestOptions</code>. Returns <code>requestOptions</code> as a convenience for chaining.</p>
<p><code>requestOptions</code> is an object holding the same options that the Node.js <a href="https://nodejs.org/docs/latest/api/http.html#http_http_request_options_callback">http.request</a> function takes.</p>
<p>The following properties of <code>requestOptions</code> are used in the signing or populated if they don't already exist:</p>
<ul>
<li><code>hostname</code> or <code>host</code> (will try to be determined from <code>service</code> and <code>region</code> if not given)</li>
<li><code>method</code> (will use &lsquo;'GET&rsquo;<code>if not given or</code>'POST'<code>if there is a</code>body<code>) -</code>path<code>(will use</code>'/'<code>if not given) -</code>body<code>(will use</code>''<code>if not given) -</code>service<code>(will try to be calculated from</code>hostname<code>or</code>host<code>if not given) -</code>region<code>(will try to be calculated from</code>hostname<code>or</code>host<code>or use</code>'us-east-1'<code>if not given) -</code>signQuery<code>(to sign the query instead of adding an</code>Authorization<code>header, defaults to false) -</code>headers['Host']<code>(will use</code>hostname<code>or</code>host<code>or be calculated if not given) -</code>headers['Content-Type']<code>(will use</code>'application/x-www-form-urlencoded; charset=utf-8'<code> if not given and there is a</code>body<code>) -</code>headers['Date']<code>(used to calculate the signature date if given, otherwise</code>new Date` is used)</li>
</ul>
<p>Your AWS credentials (which can be found in your <a href="https://portal.aws.amazon.com/gp/aws/securityCredentials">AWS console</a>) can be specified in one of two ways:</p>
<ul>
<li>As the second argument, like this:</li>
</ul>
<div class="fragment"><div class="line">aws4.sign(requestOptions, {</div>
<div class="line">  secretAccessKey: &quot;&lt;your-secret-access-key&gt;&quot;,</div>
<div class="line">  accessKeyId: &quot;&lt;your-access-key-id&gt;&quot;,</div>
<div class="line">  sessionToken: &quot;&lt;your-session-token&gt;&quot;</div>
<div class="line">})</div>
</div><!-- fragment --><ul>
<li>From <code>process.env</code>, such as this:</li>
</ul>
<div class="fragment"><div class="line">export AWS_ACCESS_KEY_ID=&quot;&lt;your-access-key-id&gt;&quot;</div>
<div class="line">export AWS_SECRET_ACCESS_KEY=&quot;&lt;your-secret-access-key&gt;&quot;</div>
<div class="line">export AWS_SESSION_TOKEN=&quot;&lt;your-session-token&gt;&quot;</div>
</div><!-- fragment --><p>(will also use <code>AWS_ACCESS_KEY</code> and <code>AWS_SECRET_KEY</code> if available)</p>
<p>The <code>sessionToken</code> property and <code>AWS_SESSION_TOKEN</code> environment variable are optional for signing with <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_use-resources.html">IAM STS temporary credentials</a>.</p>
<h1><a class="anchor" id="autotoc_md3390"></a>
Installation</h1>
<p>With <a href="https://www.npmjs.com/">npm</a> do:</p>
<div class="fragment"><div class="line">npm install aws4</div>
</div><!-- fragment --><p>Can also be used <a href="./browser">in the browser</a>.</p>
<h1><a class="anchor" id="autotoc_md3391"></a>
Thanks</h1>
<p>Thanks to <a href="https://github.com/jed">@jed</a> for his <a href="https://github.com/jed/dynamo-client">dynamo-client</a> lib where I first committed and subsequently extracted this code.</p>
<p>Also thanks to the <a href="https://github.com/aws/aws-sdk-js">official Node.js AWS SDK</a> for giving me a start on implementing the v4 signature. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
